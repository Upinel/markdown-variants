{{TOC}}

These are some tests to see how to use LaTeX environments that works in both MathJax and LaTeX. And then in vanilla Markdown, MultiMarkdown, and Pandoc Markdown, examples are given on how to write those LaTeX environments that works in both HTML and TeX generations. [^ For vanilla Markdown, only HTML output is discussed.]

TD;DR: While MathJax accepts many different ways of using the environments, it can handle the environments written in the way LaTeX uses. i.e. if the environment do not require to be in math mode (e.g. `\begin{equation}...`), you can write it in the same way in MathJax. So even if MathJax didn't specify how the environments should be used, one can find instead how it should be used in LaTeX, and do the same thing in MathJax (of course it restricts to those environments supported by MathJax). The same is not true for Markdown converter though, like MMD, see details below.
  
# The Issue: MathJax Documentation Is Ambiguous on How Environments Should Be Used #

In the end of [MathJax TeX and LaTeX Support — MathJax 2.6 documentation](http://docs.mathjax.org/en/latest/tex.html), it is mentioned under heading [Environments](http://docs.mathjax.org/en/latest/tex.html#environments) that some LaTeX environments is replicated in MathJax. However it didn't specify clearly how to use it.

In particular, in the same page under heading [Defining TeX macros](http://docs.mathjax.org/en/latest/tex.html#defining-tex-macros):

	Unlike actual TeX, however, in order for MathJax to process these, they must be enclosed in math delimiters (since MathJax only processes macros in math-mode).

Although that was from a different context, but it still might leads one to think the environments should also be enclosed in math delimiters, e.g. `\[\begin{equation}...` (although in LaTeX `\begin{equation}...` should not be used with `\[...`). Furthermore, MathJax is pretty lenient on giving you the correct result even if you write "wrong" code.

And from the [Issue #146 · mathjax/MathJax-docs](https://github.com/mathjax/MathJax-docs/issues/146), it is said that the ambiguity originates from the historical development of MathJax.

The result of this is different writers will interpret it differently and so write codes differently. And hence authors of different Markdown converter (in this context, mmd and pandoc) might made different assumptions on the source code in Markdown where environment is involved and to be converted in HTML and LaTeX.

And then a related problem is, the authors of those Markdown converter (again, mmd and pandoc in this context) also did not documents it clearly in the documentation about how those environments should be used in the corresponding Markdown code.

# Interpretations #
  
## MathJax Official Usage ##

According to the test suite provided by MathJax in [MathJax/test at master · mathjax/MathJax](https://github.com/mathjax/MathJax/tree/master/test), in the following examples:

- `/test/sample-eqnum.html`:
	- `\begin{split}...` is in `\begin{equation}...`
	- The followings are *not* in `\[...`:
		- `\begin{multline}`
		- `\begin{multline*}`
		- \begin{gather} 
		- \begin{gather*}
		- \begin{align} 
		- \begin{align*}
- `/test/sample.html`:
	- `\begin{vmatrix}` is in `\[...`

In short, from the MathJax examples, the code you should write is identical to the code you should write in LaTeX. For details, compare [MWE.html](MWE.html) and [MWE.tex](MWE.tex): the math codes are identical.

## MultiMarkdown ##

MultiMarkdown takes the assumption suggested by [Defining TeX macros](http://docs.mathjax.org/en/latest/tex.html#defining-tex-macros): `begin{...` should be within `\\[...`. In HTML output, it will be identical to the sources (`\[\begin{...`). In LaTeX output, it will becomes `\begin{...`. This will leads to a problem that some `begin{...` environment like `\begin{aligned}...` expects a equation environment (e.g. `\[\begin{aligned}...`. See workarounds below, and in [MWE-mmd.mmd](MWE-mmd.mmd) and its output.

Notes: There is an issue about using `$$` and `begin{...` together and is fixed in the latest MMD: [begin equation in $$ / Problems / Discussion Area - MultiMarkdown Support](http://support.fletcherpenney.net/discussions/problems/677-begin-equation-in)

## Pandoc ##

Pandora is similar to the MathJax Official Usage: the source math code is identical to the generated HTML and LaTeX code. See [MWE-pandoc.md](MWE-pandoc.md) and its output.

# A Note on the Test Files #

I got lazy so in all environments I used the same equation to test.

All environments listed under [Environments in MathJax Documentation](http://docs.mathjax.org/en/latest/tex.html#environments) are used.

All `*.PDF` are generated by the corresponding `*.TeX` file.

- `/archive/`: forget about these. It's the first tests I did to try to figure out what MathJax, mmd, and pandoc assumes.
- `MWE.*`: vanilla HTML and LaTeX respectively. The math codes involved are identical: the official way MathJax is supposed to be used.
- `MWE-md.*`: Written in vanilla Markdown. The only difference in the math code is the use of `\\[...` instead of `\[...`. An example HTML is generated by MMD2HTML (but the HTML produced is *supposed* to be identical [^ although the `\` could becomes the trouble maker]).
- `MWE-mmd.*`: Written in MultiMarkdown, meaning that `begin{...` is typed as `\\[begin{...` instead. In case the environment really expects to be within another environment, a line break is used such that `\\[` and `begin{...` is not consecutive. HTML and TeX are generated by MMD2HTML and MMD2TeX [^ where [ickc/peg-multimarkdown-latex-support: Default support files for generating LaTeX documents with MMD 3 through MMD 5](https://github.com/ickc/peg-multimarkdown-latex-support) is used for easy LaTeX setup (e.g. loading packages)]
- `MWE-pandoc.*`: Written in pandoc's Markdown. `$$` is used, but otherwise identical to `MWE.md`. `--mathjax` argument is used in the conversion to HTML: `pandoc --mathjax -s -o ...`. [^ done in the way I did (that I load the MathJax in the md file), MathJax would be loaded twice. However, without `--mathjax` many equations would disappeared from the HTML output. Probably the best way is to change the template of how MathJax is loaded instead, but I didn't dig into it.]. TeX is generated by `pandoc -s -o ...` [^ and I ignored the error that complains about `amscd` is not loaded. Again probably one should change the template.].

# Defining TeX Macros #

Added a folder `newcommand` when LaTeX command `\newcommand` is used. Currently there is no way to generate correct HTML and LaTeX results from the same md sources, in both mmd and pandoc. It is because MathJax requires an extra delimiter around the `\newcommand`, but LaTeX doesn't. mmd is smart enough to handle this in `\\(\begin{...` situation, but not `\\(\newcommand...`.